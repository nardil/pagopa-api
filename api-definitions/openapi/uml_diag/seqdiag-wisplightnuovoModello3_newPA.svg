<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1482px" preserveAspectRatio="none" style="width:1129px;height:1482px;" version="1.1" viewBox="0 0 1129 1482" width="1129px" zoomAndPan="magnify"><defs><filter height="300%" id="f147gwjt1yxsxs" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="326" x="398" y="29.4023">Payment process activated by the PSP</text><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="319.2061"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="476.7139"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="780.5088"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="1282.4434"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="125.8975" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="264.585"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="113.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="434.748"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="173.208" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="691.2324"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="1132.8906"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="342.6816" style="stroke:#000000;stroke-width:2.0;" width="959" x="153" y="213.3086"/><rect fill="#FFFFFF" height="157.5078" style="stroke:none;stroke-width:1.0;" width="959" x="153" y="398.4824"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="204.1738" style="stroke:#000000;stroke-width:2.0;" width="698" x="81" y="1177.2012"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="298.5" x="277" y="1243.8223"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="305" x2="305" y1="123.6875" y2="1398.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="529.5" x2="529.5" y1="123.6875" y2="1398.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="774" x2="774" y1="123.6875" y2="1398.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="971.5" x2="971.5" y1="123.6875" y2="1398.375"/><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="32" x="287" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="294" y="108.7344">EC</text><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="32" x="287" y="1397.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="294" y="1417.9102">EC</text><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="67" x="494.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="501.5" y="108.7344">pagoPA</text><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="67" x="494.5" y="1397.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="501.5" y="1417.9102">pagoPA</text><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="38" x="753" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="24" x="760" y="108.7344">PSP</text><rect fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="38" x="753" y="1397.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="24" x="760" y="1417.9102">PSP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="953.5" y="120.7344">User</text><ellipse cx="972" cy="50.1992" fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M972,58.1992 L972,85.1992 M959,66.1992 L985,66.1992 M972,85.1992 L959,100.1992 M972,85.1992 L985,100.1992 " fill="none" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="953.5" y="1410.9102">User</text><ellipse cx="972" cy="1423.8633" fill="#FEFECE" filter="url(#f147gwjt1yxsxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M972,1431.8633 L972,1458.8633 M959,1439.8633 L985,1439.8633 M972,1458.8633 L959,1473.8633 M972,1458.8633 L985,1473.8633 " fill="none" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="319.2061"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="476.7139"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="41.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="780.5088"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300" y="1282.4434"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="125.8975" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="264.585"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="113.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="434.748"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="173.208" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="691.2324"/><rect fill="#FFFFFF" filter="url(#f147gwjt1yxsxs)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="525" y="1132.8906"/><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1122" x="0" y="154.3428"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="154.3428" y2="154.3428"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="157.3428" y2="157.3428"/><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="171" x="475.5" y="143.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="481.5" y="160.2559">verify phase (optional)</text><polygon fill="#0000FF" points="785,194.3086,775,198.3086,785,202.3086,781,198.3086" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="779" x2="971" y1="198.3086" y2="198.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="791" y="193.5664">Payment Notice</text><path d="M153,213.3086 L215,213.3086 L215,220.3086 L205,230.3086 L153,230.3086 L153,213.3086 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="342.6816" style="stroke:#000000;stroke-width:2.0;" width="959" x="153" y="213.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="168" y="226.877">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="230" y="225.9434">[QR-CODE]</text><polygon fill="#A80036" points="546,260.585,536,264.585,546,268.585,542,264.585" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="773" y1="264.585" y2="264.585"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="552" y="259.8428">verifyPaymentNotice req</text><path d="M779,235.6191 L779,275.6191 L1093,275.6191 L1093,245.6191 L1083,235.6191 L779,235.6191 " fill="#FBFB77" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1083,235.6191 L1083,245.6191 L1093,245.6191 L1083,235.6191 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="785" y="253.1875">The PSP requests the verification of the notice</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="789" y="268.498">(check amount)</text><polygon fill="#A80036" points="321,315.2061,311,319.2061,321,323.2061,317,319.2061" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315" x2="524" y1="319.2061" y2="319.2061"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="327" y="314.4639">paVerifyPaymentNotice req</text><path d="M163,290.2402 L163,330.2402 L291,330.2402 L291,300.2402 L281,290.2402 L163,290.2402 " fill="#00FFFF" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M281,290.2402 L281,300.2402 L291,300.2402 L281,290.2402 " fill="#00FFFF" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="169" y="307.8086">Debt Position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="173" y="323.1191">STATUS =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="239" y="323.1191">Open</text><polygon fill="#A80036" points="513,357.1719,523,361.1719,513,365.1719,517,361.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="305" x2="519" y1="361.1719" y2="361.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="312" y="356.4297">paVerifyPaymentNotice res</text><polygon fill="#A80036" points="762,386.4824,772,390.4824,762,394.4824,766,390.4824" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="530" x2="768" y1="390.4824" y2="390.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="537" y="385.7402">verifyPaymentNotice res</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="1112" y1="399.4824" y2="399.4824"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="158" y="410.1172">[BARCODE-128-AIM]</text><polygon fill="#A80036" points="546,430.748,536,434.748,546,438.748,542,434.748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="773" y1="434.748" y2="434.748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="552" y="430.0059">verificaBollettino req</text><polygon fill="#A80036" points="321,472.7139,311,476.7139,321,480.7139,317,476.7139" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315" x2="524" y1="476.7139" y2="476.7139"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="327" y="471.9717">paVerifyPaymentNotice req</text><path d="M163,447.748 L163,487.748 L291,487.748 L291,457.748 L281,447.748 L163,447.748 " fill="#00FFFF" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M281,447.748 L281,457.748 L291,457.748 L281,447.748 " fill="#00FFFF" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="169" y="465.3164">Debt Position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="173" y="480.627">STATUS =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="239" y="480.627">Open</text><polygon fill="#A80036" points="513,514.6797,523,518.6797,513,522.6797,517,518.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="305" x2="519" y1="518.6797" y2="518.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="312" y="513.9375">paVerifyPaymentNotice res</text><polygon fill="#A80036" points="762,543.9902,772,547.9902,762,551.9902,766,547.9902" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="530" x2="768" y1="547.9902" y2="547.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="537" y="543.248">verificaBollettino res</text><polygon fill="#0000FF" points="960,580.3008,970,584.3008,960,588.3008,964,584.3008" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="774" x2="966" y1="584.3008" y2="584.3008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="781" y="579.5586">Notice verified and updated</text><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1122" x="0" y="612.9561"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="612.9561" y2="612.9561"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="615.9561" y2="615.9561"/><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="116" x="503" y="602.3008"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="509" y="618.8691">activate phase</text><polygon fill="#0000FF" points="785,652.9219,775,656.9219,785,660.9219,781,656.9219" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="779" x2="971" y1="656.9219" y2="656.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="791" y="652.1797">Confirm willingness to pay</text><polygon fill="#A80036" points="546,687.2324,536,691.2324,546,695.2324,542,691.2324" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="773" y1="691.2324" y2="691.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="552" y="686.4902">activatePaymentNotice req</text><path d="M779,669.9219 L779,694.9219 L1027,694.9219 L1027,679.9219 L1017,669.9219 L779,669.9219 " fill="#FBFB77" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1017,669.9219 L1017,679.9219 L1027,679.9219 L1017,669.9219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="785" y="687.4902">The PSP requires payment activation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="535" x2="577" y1="725.543" y2="725.543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="577" x2="577" y1="725.543" y2="738.543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="577" y1="738.543" y2="738.543"/><polygon fill="#A80036" points="546,734.543,536,738.543,546,742.543,542,738.543" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="542" y="720.8008">token generation (</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="657" y="720.8008">token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="693" y="720.8008">)</text><polygon fill="#A80036" points="321,776.5088,311,780.5088,321,784.5088,317,780.5088" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315" x2="524" y1="780.5088" y2="780.5088"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="327" y="775.7666">paGetPayment req</text><path d="M163,751.543 L163,791.543 L291,791.543 L291,761.543 L281,751.543 L163,751.543 " fill="#00FFFF" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M281,751.543 L281,761.543 L291,761.543 L281,751.543 " fill="#00FFFF" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="169" y="769.1113">Debt Position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="173" y="784.4219">STATUS =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="239" y="784.4219">Open</text><polygon fill="#A80036" points="513,818.4746,523,822.4746,513,826.4746,517,822.4746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="305" x2="519" y1="822.4746" y2="822.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="312" y="817.7324">paGetPayment res</text><polygon fill="#A80036" points="762,860.4404,772,864.4404,762,868.4404,766,864.4404" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="530" x2="768" y1="864.4404" y2="864.4404"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="537" y="859.6982">activatePaymentNotice res (</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="711" y="859.6982">token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="747" y="859.6982">)</text><path d="M779,835.4746 L779,875.4746 L932,875.4746 L932,845.4746 L922,835.4746 L779,835.4746 " fill="#FBFB77" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M922,835.4746 L922,845.4746 L932,845.4746 L922,835.4746 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="785" y="853.043">The PSP has all data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="785" y="868.3535">to allow the payment</text><polygon fill="#0000FF" points="960,902.4063,970,906.4063,960,910.4063,964,906.4063" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="774" x2="966" y1="906.4063" y2="906.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="781" y="901.6641">Payment page</text><path d="M5,919.4063 L5,974.4063 L296,974.4063 L296,929.4063 L286,919.4063 L5,919.4063 " fill="#FFC0CB" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,919.4063 L286,929.4063 L296,929.4063 L286,919.4063 " fill="#FFC0CB" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="11" y="936.9746">Newly configured ECs</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="11" y="952.2852">DOES'NT HAVE TO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="138" y="952.2852">lock the debt position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="11" y="967.5957">after activation.</text><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1122" x="0" y="1004.9932"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="1004.9932" y2="1004.9932"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1122" y1="1007.9932" y2="1007.9932"/><rect fill="#EEEEEE" filter="url(#f147gwjt1yxsxs)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="147" x="487.5" y="994.3379"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="493.5" y="1010.9063">send receipt phase</text><polygon fill="#0000FF" points="785,1044.959,775,1048.959,785,1052.959,781,1048.959" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="779" x2="971" y1="1048.959" y2="1048.959"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="791" y="1044.2168">Pay</text><path d="M779,1061.959 L779,1101.959 L990,1101.959 L990,1071.959 L980,1061.959 L779,1061.959 " fill="#FBFB77" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M980,1061.959 L980,1071.959 L990,1071.959 L980,1061.959 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="785" y="1079.5273">If payment OK -&gt;  Outcome +</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="785" y="1094.8379">If payment KO -&gt; Outcome -</text><polygon fill="#A80036" points="546,1128.8906,536,1132.8906,546,1136.8906,542,1132.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="773" y1="1132.8906" y2="1132.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="552" y="1128.1484">sendPaymentOutcome req (</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="724" y="1128.1484">token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="760" y="1128.1484">)</text><polygon fill="#A80036" points="762,1158.2012,772,1162.2012,762,1166.2012,766,1162.2012" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="530" x2="768" y1="1162.2012" y2="1162.2012"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="537" y="1157.459">sendPaymentOutcome res</text><path d="M81,1177.2012 L148,1177.2012 L148,1184.2012 L138,1194.2012 L81,1194.2012 L81,1177.2012 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="204.1738" style="stroke:#000000;stroke-width:2.0;" width="698" x="81" y="1177.2012"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="96" y="1190.7695">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="163" y="1189.8359">[Only in case of outcome +]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="530" x2="572" y1="1215.8223" y2="1215.8223"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572" x2="572" y1="1215.8223" y2="1228.8223"/><line style="stroke:#A80036;stroke-width:1.0;" x1="531" x2="572" y1="1228.8223" y2="1228.8223"/><polygon fill="#A80036" points="541,1224.8223,531,1228.8223,541,1232.8223,537,1228.8223" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="537" y="1211.0801">receipt generation (idReceipt=</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="727" y="1211.0801">token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="763" y="1211.0801">)</text><path d="M277,1243.8223 L351,1243.8223 L351,1250.8223 L341,1260.8223 L277,1260.8223 L277,1243.8223 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="298.5" x="277" y="1243.8223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="292" y="1257.3906">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="366" y="1256.457">[for each EC in transfer list]</text><polygon fill="#A80036" points="321,1278.4434,311,1282.4434,321,1286.4434,317,1282.4434" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315" x2="529" y1="1282.4434" y2="1282.4434"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="327" y="1277.7012">paSendRT req (idReceipt=</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="488" y="1277.7012">token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="524" y="1277.7012">)</text><polygon fill="#A80036" points="518,1307.7539,528,1311.7539,518,1315.7539,522,1311.7539" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="305" x2="524" y1="1311.7539" y2="1311.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="312" y="1307.0117">paSendRT res</text><path d="M91,1331.7539 L91,1371.7539 L296,1371.7539 L296,1341.7539 L286,1331.7539 L91,1331.7539 " fill="#00FFFF" filter="url(#f147gwjt1yxsxs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,1331.7539 L286,1341.7539 L296,1341.7539 L286,1331.7539 " fill="#00FFFF" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="97" y="1349.3223">Debt Position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="101" y="1364.6328">STATUS = **Open -&gt; Closed</text><!--MD5=[2dbb939d260ea6364d45fb11cb03f5db]
@startuml uml_diag/seqdiag-wisplightnuovoModello3_newPA
title Payment process activated by the PSP

participant EC
participant pagoPA
participant PSP
actor       User

== verify phase (optional) ==

User [#blue]-> PSP: Payment Notice

alt QR-CODE
    PSP -> pagoPA: verifyPaymentNotice req
    note right : The PSP requests the verification of the notice \n (check amount)
    activate pagoPA
    pagoPA -> EC: paVerifyPaymentNotice req
    note left #aqua : Debt Position\n STATUS = **Open**
    activate EC
    EC -> pagoPA: paVerifyPaymentNotice res
    deactivate EC
    pagoPA -> PSP: verifyPaymentNotice res
    deactivate pagoPA
else BARCODE-128-AIM 
    PSP -> pagoPA: verificaBollettino req
    activate pagoPA
    pagoPA -> EC: paVerifyPaymentNotice req
    note left #aqua : Debt Position\n STATUS = **Open**
    activate EC
    EC -> pagoPA: paVerifyPaymentNotice res
    deactivate EC
    pagoPA -> PSP: verificaBollettino res
    deactivate pagoPA
end

PSP [#blue]-> User: Notice verified and updated

== activate phase ==

User [#blue]-> PSP: Confirm willingness to pay
PSP -> pagoPA: activatePaymentNotice req
note right : The PSP requires payment activation
activate pagoPA
pagoPA -> pagoPA: token generation (<color blue>token</color>)
pagoPA -> EC: paGetPayment req
note left #aqua : Debt Position\n STATUS = **Open**
activate EC
EC -> pagoPA: paGetPayment res
deactivate EC
pagoPA -> PSP: activatePaymentNotice res (<color blue>token</color>)
note right : The PSP has all data \nto allow the payment
deactivate pagoPA

PSP [#blue]-> User: Payment page
note left EC #pink : Newly configured ECs \n**DOES'NT HAVE TO** lock the debt position \nafter activation.

== send receipt phase ==

User [#blue]-> PSP: Pay
note right PSP : If payment OK ->  Outcome +\nIf payment KO -> Outcome -

PSP -> pagoPA: sendPaymentOutcome req (<color blue>token</color>)
activate pagoPA
pagoPA -> PSP: sendPaymentOutcome res
deactivate pagoPA
opt Only in case of outcome + 
    pagoPA -> pagoPA: receipt generation (idReceipt=<color blue>token</color>)
    loop for each EC in transfer list
        pagoPA -> EC: paSendRT req (idReceipt=<color blue>token</color>)
        activate EC
        EC -> pagoPA: paSendRT res
        deactivate EC
    end 
    note left EC #aqua: Debt Position\n STATUS = **Open -> Closed
end

@enduml

PlantUML version 1.2020.26(Mon Dec 21 18:45:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>